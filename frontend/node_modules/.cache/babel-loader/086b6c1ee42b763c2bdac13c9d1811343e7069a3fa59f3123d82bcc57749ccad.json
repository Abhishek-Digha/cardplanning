{"ast":null,"code":"import React,{useState}from'react';import{useSession}from'../contexts/SessionContext';import{sessionAPI}from'../utils/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const POINTS=[1,2,3,5,8,13,21,'?'];export default function VotingBoard(){const{session,user,activeStory,votes,isRevealed,voteCount,totalMembers}=useSession();const[sel,setSel]=useState(null);const prevStoryId=React.useRef(activeStory===null||activeStory===void 0?void 0:activeStory.id);// Clear selection when story changes\nReact.useEffect(()=>{if((activeStory===null||activeStory===void 0?void 0:activeStory.id)!==prevStoryId.current){setSel(null);prevStoryId.current=activeStory===null||activeStory===void 0?void 0:activeStory.id;}},[activeStory===null||activeStory===void 0?void 0:activeStory.id]);const{dispatch}=useSession();const vote=async p=>{if(!activeStory||isRevealed)return;setSel(p);// Optimistically update votes and voteCount for instant feedback\nconst alreadyVoted=votes[user.id]!==undefined;const newVotes={...votes,[user.id]:p};const newVoteCount=alreadyVoted?voteCount:voteCount+1;dispatch({type:'SET',payload:{votes:newVotes,voteCount:newVoteCount}});await sessionAPI.vote(session.id,user.id,activeStory.id,p);};const avg=(()=>{const nums=Object.values(votes).filter(v=>typeof v==='number');return nums.length?(nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(1):0;})();if(!activeStory)return/*#__PURE__*/_jsx(\"div\",{className:\"voting-board\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"No Active Story\"})});// Find card number (index+1) for active story in stories array\nconst{stories}=useSession();let cardNumber=null;if(activeStory&&stories&&stories.length>0){const idx=stories.findIndex(s=>s.id===activeStory.id);if(idx!==-1)cardNumber=idx+1;}return/*#__PURE__*/_jsxs(\"div\",{className:\"voting-board\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:600,fontSize:'1.1rem',color:'#1976d2',marginBottom:6},children:[\"Card Name: \",activeStory.title]}),activeStory.description&&/*#__PURE__*/_jsx(\"p\",{children:activeStory.description}),!isRevealed?/*#__PURE__*/_jsx(\"div\",{className:\"cards\",children:POINTS.map(p=>/*#__PURE__*/_jsx(\"button\",{className:sel===p?'selected':'',onClick:()=>vote(p),children:p},p))}):/*#__PURE__*/_jsx(\"div\",{className:\"results\",children:/*#__PURE__*/_jsx(\"div\",{style:{background:'linear-gradient(90deg, #f8fafc 0%, #e0e7ef 100%)',borderRadius:'20px',boxShadow:'0 4px 24px rgba(0,0,0,0.13)',padding:'3.5vw',width:'100%',maxWidth:'1400px',minWidth:'min(90vw, 600px)',border:'1px solid #e0e7ef',margin:'0 auto 2.5rem auto',transition:'max-width 0.3s, padding 0.3s'},children:/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'separate',borderSpacing:0,background:'white',borderRadius:12,overflow:'hidden',boxShadow:'0 1px 8px rgba(0,0,0,0.05)'},children:[/*#__PURE__*/_jsx(\"thead\",{style:{background:'#e0e7ef'},children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{padding:'16px 18px',textAlign:'left',color:'#2d3a4a',fontWeight:600,borderBottom:'2px solid #d1d5db',fontSize:'1.05rem'},children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{style:{padding:'16px 18px',textAlign:'center',color:'#2d3a4a',fontWeight:600,borderBottom:'2px solid #d1d5db',fontSize:'1.05rem'},children:\"Vote\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:session.members.map((m,idx)=>/*#__PURE__*/_jsxs(\"tr\",{style:{background:idx%2===0?'#f8fafc':'white'},children:[/*#__PURE__*/_jsx(\"td\",{style:{padding:'16px 18px',borderBottom:'1px solid #f1f5f9',fontSize:'1.05rem'},children:m.name}),/*#__PURE__*/_jsx(\"td\",{style:{padding:'16px 18px',textAlign:'center',borderBottom:'1px solid #f1f5f9',fontSize:'1.05rem'},children:votes[m.id]!==undefined?votes[m.id]:'No vote'})]},m.id))})]})})})]});}","map":{"version":3,"names":["React","useState","useSession","sessionAPI","jsx","_jsx","jsxs","_jsxs","POINTS","VotingBoard","session","user","activeStory","votes","isRevealed","voteCount","totalMembers","sel","setSel","prevStoryId","useRef","id","useEffect","current","dispatch","vote","p","alreadyVoted","undefined","newVotes","newVoteCount","type","payload","avg","nums","Object","values","filter","v","length","reduce","a","b","toFixed","className","children","stories","cardNumber","idx","findIndex","s","style","fontWeight","fontSize","color","marginBottom","title","description","map","onClick","background","borderRadius","boxShadow","padding","width","maxWidth","minWidth","border","margin","transition","borderCollapse","borderSpacing","overflow","textAlign","borderBottom","members","m","name"],"sources":["C:/Users/abhis/Downloads/story-pointing-app/frontend/src/components/VotingBoard.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useSession } from '../contexts/SessionContext';\r\nimport { sessionAPI } from '../utils/api';\r\n\r\nconst POINTS=[1,2,3,5,8,13,21,'?'];\r\n\r\nexport default function VotingBoard(){\r\n  const {session,user,activeStory,votes,isRevealed,voteCount,totalMembers} = useSession();\r\n  const [sel,setSel]=useState(null);\r\n  const prevStoryId = React.useRef(activeStory?.id);\r\n\r\n  // Clear selection when story changes\r\n  React.useEffect(() => {\r\n    if (activeStory?.id !== prevStoryId.current) {\r\n      setSel(null);\r\n      prevStoryId.current = activeStory?.id;\r\n    }\r\n  }, [activeStory?.id]);\r\n\r\n  const { dispatch } = useSession();\r\n  const vote = async p => {\r\n    if (!activeStory || isRevealed) return;\r\n    setSel(p);\r\n    // Optimistically update votes and voteCount for instant feedback\r\n    const alreadyVoted = votes[user.id] !== undefined;\r\n    const newVotes = { ...votes, [user.id]: p };\r\n    const newVoteCount = alreadyVoted ? voteCount : voteCount + 1;\r\n    dispatch({ type: 'SET', payload: { votes: newVotes, voteCount: newVoteCount } });\r\n    await sessionAPI.vote(session.id, user.id, activeStory.id, p);\r\n  };\r\n\r\n  const avg=(()=>{\r\n    const nums=Object.values(votes).filter(v=>typeof v==='number');\r\n    return nums.length\r\n      ?(nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(1)\r\n      :0;\r\n  })();\r\n\r\n  if(!activeStory) return (\r\n    <div className=\"voting-board\">\r\n      <h2>No Active Story</h2>\r\n    </div>\r\n  );\r\n\r\n  // Find card number (index+1) for active story in stories array\r\n  const { stories } = useSession();\r\n  let cardNumber = null;\r\n  if (activeStory && stories && stories.length > 0) {\r\n    const idx = stories.findIndex(s => s.id === activeStory.id);\r\n    if (idx !== -1) cardNumber = idx + 1;\r\n  }\r\n\r\n  return (\r\n    <div className=\"voting-board\">\r\n      <div style={{fontWeight:600, fontSize:'1.1rem', color:'#1976d2', marginBottom:6}}>Card Name: {activeStory.title}</div>\r\n      {activeStory.description && <p>{activeStory.description}</p>}\r\n\r\n      {!isRevealed ? (\r\n        <div className=\"cards\">\r\n          {POINTS.map(p=>(\r\n            <button\r\n              key={p}\r\n              className={sel===p?'selected':''}\r\n              onClick={()=>vote(p)}\r\n            >{p}</button>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"results\">\r\n          {/* Average display removed as requested */}\r\n          <div style={{\r\n            background: 'linear-gradient(90deg, #f8fafc 0%, #e0e7ef 100%)',\r\n            borderRadius: '20px',\r\n            boxShadow: '0 4px 24px rgba(0,0,0,0.13)',\r\n            padding: '3.5vw',\r\n            width: '100%',\r\n            maxWidth: '1400px',\r\n            minWidth: 'min(90vw, 600px)',\r\n            border: '1px solid #e0e7ef',\r\n            margin: '0 auto 2.5rem auto',\r\n            transition: 'max-width 0.3s, padding 0.3s',\r\n          }}>\r\n            <table style={{width: '100%', borderCollapse: 'separate', borderSpacing: 0, background: 'white', borderRadius: 12, overflow: 'hidden', boxShadow: '0 1px 8px rgba(0,0,0,0.05)'}}>\r\n              <thead style={{background: '#e0e7ef'}}>\r\n                <tr>\r\n                  <th style={{padding: '16px 18px', textAlign: 'left', color: '#2d3a4a', fontWeight: 600, borderBottom: '2px solid #d1d5db', fontSize: '1.05rem'}}>User</th>\r\n                  <th style={{padding: '16px 18px', textAlign: 'center', color: '#2d3a4a', fontWeight: 600, borderBottom: '2px solid #d1d5db', fontSize: '1.05rem'}}>Vote</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {session.members.map((m, idx) => (\r\n                  <tr key={m.id} style={{background: idx % 2 === 0 ? '#f8fafc' : 'white'}}>\r\n                    <td style={{padding: '16px 18px', borderBottom: '1px solid #f1f5f9', fontSize: '1.05rem'}}>{m.name}</td>\r\n                    <td style={{padding: '16px 18px', textAlign: 'center', borderBottom: '1px solid #f1f5f9', fontSize: '1.05rem'}}>{votes[m.id]!==undefined?votes[m.id]:'No vote'}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}